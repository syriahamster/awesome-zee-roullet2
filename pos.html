<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Lightweight HTML POS with Backup/Restore, Modals, Dark Mode & UI ê°œì„ </title>
  <style>
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #fff;
      color: #000;
    }
    header {
      background-color: #333;
      color: #fff;
      padding: 10px;
    }
    header h1 { margin: 0 0 10px 0; }
    
    /* Nav bar: ì™¼ìª½ ëª¨ë“œ ë²„íŠ¼, ì˜¤ë¥¸ìª½ ë°±ì—…/ë³µì›, ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* ì¢Œì¸¡ ë‚´ë¹„ê²Œì´ì…˜ (ëª¨ë“œ ë²„íŠ¼) */
    #nav-modes button {
      margin-right: 10px;
      padding: 8px 12px;
      cursor: pointer;
    }
    /* ì˜¤ë¥¸ìª½ ë‚´ë¹„ ë²„íŠ¼ë“¤ */
    #nav-export-import button {
      margin-right: 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
    /* ì„ íƒëœ ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #nav-modes button.selected {
      background-color: #555;
      color: #fff;
      border: none;
    }
    
    /* disabled ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    /* ë‹¤í¬ëª¨ë“œ: disabled ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    body.dark-mode button:disabled {
      background-color: #555;
      color: #999;
    }
    
    .section { padding: 20px; display: none; }
    .active { display: block; }
    
    /* ê³µìš© ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .item-list { margin-top: 20px; }
    .item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      text-align: center;
    }
    .item img {
      max-width: 100%;
      height: auto;
      margin-bottom: 5px;
    }
    
    /* íŒë§¤í™”ë©´: available items grid ìŠ¤íƒ€ì¼ */
    #salesContainer {
      display: flex;
      flex-direction: row;
      gap: 10px;
    }
    #availableItems {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }
    /* íŒë§¤í™”ë©´: ê° ì•„ì´í…œì€ í´ë¦­ ì‹œ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ */
    #availableItems .item {
      cursor: pointer;
      border: 1px solid #aaa;
      padding: 10px;
      transition: background-color 0.2s;
    }
    #availableItems .item:hover {
      background-color: #f0f0f0;
    }
    
    /* íŒë§¤í™”ë©´: ì¥ë°”êµ¬ë‹ˆ ì˜ì—­ (50% width) */
    #cartContainer {
      width: 50%;
      min-width: 200px;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
    }
    #cartContainer h3 { margin-top: 0; }
    .cart-item {
      border-bottom: 1px solid #ccc;
      padding: 5px 0;
    }
    .cart-item button { margin: 0 2px; }
    
    /* íŒë§¤ ë²„íŠ¼ í¬ê²Œ */
    #sellBtn {
      font-size: 1.5em;
      padding: 10px 20px;
      margin-top: 10px;
    }
    
    /* Modal (ì•„ì´í…œ ì¶”ê°€/ìˆ˜ì •) ìŠ¤íƒ€ì¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 400px;
    }
    .modal-content label {
      display: block;
      margin-top: 10px;
    }
    .modal-content input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    .modal-content button {
      padding: 8px 12px;
      margin-top: 15px;
      margin-right: 5px;
    }
    
    /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    body.dark-mode header { background-color: #1e1e1e; color: #e0e0e0; }
    body.dark-mode nav button { background-color: #444; color: #e0e0e0; }
    body.dark-mode #cartContainer { background-color: #1e1e1e; border-color: #555; }
    body.dark-mode .item,
    body.dark-mode .cart-item { border-color: #555; }
    body.dark-mode .modal-content { background-color: #333; color: #e0e0e0; border-color: #555; }
    
    /* "ìƒˆ ì•„ì´í…œ ì¶”ê°€" ë²„íŠ¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    #openNewItemModalBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 2px dashed #888;
      padding: 20px;
      cursor: pointer;
      font-size: 1.2em;
      background-color: transparent;
      color: inherit;
      margin-bottom: 20px;
    }
    #openNewItemModalBtn:hover { background-color: #f0f0f0; }
    body.dark-mode #openNewItemModalBtn:hover { background-color: #333; }
  </style>
</head>
<body>
  <header>
    <h1>Lightweight HTML POS</h1>
    <nav>
      <div id="nav-modes">
        <button id="editModeBtn">í¸ì§‘í™”ë©´</button>
        <button id="salesModeBtn">íŒë§¤í™”ë©´</button>
        <button id="historyModeBtn">íŒë§¤ë‚´ì—­</button>
      </div>
      <div id="nav-export-import">
        <button id="exportBtn">ì „ì²´ë‚´ìš© ë°±ì—…í•˜ê¸°</button>
        <button id="importBtn">ë³µì›í•˜ê¸°</button>
        <button id="darkModeToggle">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
        <input type="file" id="importFile" accept="application/json" style="display: none;">
      </div>
    </nav>
  </header>

  <!-- í¸ì§‘í™”ë©´ -->
  <div id="editMode" class="section active">
    <h2>í¸ì§‘í™”ë©´</h2>
    <button id="openNewItemModalBtn">ï¼‹ ìƒˆ ì•„ì´í…œ ì¶”ê°€</button>
    <div id="itemsList" class="item-list">
      <!-- ì•„ì´í…œ ëª©ë¡ (grid) -->
    </div>
  </div>

  <!-- íŒë§¤í™”ë©´ -->
  <div id="salesMode" class="section">
    <h2>íŒë§¤í™”ë©´</h2>
    <div id="salesContainer">
      <div id="availableItems">
        <!-- ì‚¬ìš© ê°€ëŠ¥í•œ ìƒí’ˆ grid -->
      </div>
      <div id="cartContainer">
        <h3>ì¥ë°”êµ¬ë‹ˆ</h3>
        <div id="cart" class="cart-list"></div>
        <div>
          <strong>ì´ í•©ê³„:</strong> <span id="totalPrice">0</span> ì›
        </div>
        <button id="sellBtn">íŒë§¤</button>
      </div>
    </div>
  </div>

  <!-- íŒë§¤ë‚´ì—­ -->
  <div id="historyMode" class="section">
    <h2>íŒë§¤ë‚´ì—­</h2>
    <div id="historyList" class="history-list">
      <!-- ë‚ ì§œë³„ ê±°ë˜ ë‚´ì—­ (ìµœì‹  ê±°ë˜ê°€ ìœ„ì—) -->
    </div>
  </div>

  <!-- Modal for Add/Edit Item -->
  <div id="itemModal" class="modal">
    <div class="modal-content">
      <h2 id="itemModalTitle">ì•„ì´í…œ ì¶”ê°€</h2>
      <form id="itemModalForm">
        <label for="modalItemName">ìƒí’ˆ ì´ë¦„:</label>
        <input type="text" id="modalItemName" required>
        <label for="modalItemPrice">ìƒí’ˆ ê°€ê²©:</label>
        <input type="number" id="modalItemPrice" required min="0">
        <label for="modalItemImageFile">ìƒí’ˆ ì´ë¯¸ì§€ (ì„ íƒ):</label>
        <input type="file" id="modalItemImageFile" accept="image/*">
        <div style="text-align: right;">
          <button type="button" id="modalCancelBtn">ì·¨ì†Œ</button>
          <button type="submit" id="modalSaveBtn">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    /***** IndexedDB ì´ˆê¸°í™” *****/
    let db;
    const request = indexedDB.open("posDB", 1);
    request.onupgradeneeded = function(event) {
      db = event.target.result;
      if (!db.objectStoreNames.contains("images")) {
        db.createObjectStore("images", { keyPath: "id" });
      }
    };
    request.onsuccess = function(event) { db = event.target.result; };
    request.onerror = function(event) { console.error("IndexedDB error:", event); };

    // IndexedDB: ì´ë¯¸ì§€ ì €ì¥
    function storeImageInDB(id, blob) {
      if (!db) return;
      const transaction = db.transaction(["images"], "readwrite");
      const store = transaction.objectStore("images");
      store.put({ id: id, blob: blob });
    }
    // IndexedDB: ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸° (object URL ë°˜í™˜)
    function getImageFromDB(id, callback) {
      if (!db) { callback(null); return; }
      const transaction = db.transaction(["images"], "readonly");
      const store = transaction.objectStore("images");
      const req = store.get(id);
      req.onsuccess = function(event) {
        const result = event.target.result;
        if (result && result.blob) {
          const url = URL.createObjectURL(result.blob);
          callback(url);
        } else { callback(null); }
      };
      req.onerror = function() { callback(null); };
    }

    /***** ë°ì´í„° ì €ì¥ ë³€ìˆ˜ *****/
    let items = [];       // ë“±ë¡ëœ ìƒí’ˆ ëª©ë¡
    let cart = {};        // íŒë§¤í™”ë©´ ì¥ë°”êµ¬ë‹ˆ (ìƒí’ˆ id í‚¤)
    let saleHistory = []; // íŒë§¤(ì˜ìˆ˜ì¦) ë‚´ì—­

    /***** ê°€ê²© í¬ë§·íŒ… (3ìë¦¬ë§ˆë‹¤ ì‰¼í‘œ) *****/
    function formatPrice(num) { return num.toLocaleString(); }

    /***** ëª¨ë“œ ì „í™˜ ë° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ *****/
    function updateNavButtons() {
      // íŒë§¤í™”ë©´ ë²„íŠ¼: ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìœ¼ë©´ ë¹„í™œì„±í™”
      document.getElementById('salesModeBtn').disabled = (items.length === 0);
      // íŒë§¤ë‚´ì—­ ë²„íŠ¼: íŒë§¤ ë‚´ì—­ì´ ì—†ìœ¼ë©´ ë¹„í™œì„±í™”
      document.getElementById('historyModeBtn').disabled = (saleHistory.length === 0);
    }
    function updateSelectedNav(selectedId) {
      // ëª¨ë“  ëª¨ë“œ ë²„íŠ¼ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
      document.querySelectorAll("#nav-modes button").forEach(btn => {
        btn.classList.remove("selected");
      });
      // ì„ íƒëœ ë²„íŠ¼ì— selected í´ë˜ìŠ¤ ì¶”ê°€ (disabled ìƒíƒœë¼ë©´ ì¶”ê°€ë˜ì§€ ì•ŠìŒ)
      const selBtn = document.getElementById(selectedId);
      if (selBtn && !selBtn.disabled) { selBtn.classList.add("selected"); }
    }
    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      if (sectionId === 'salesMode') {
        renderAvailableItems();
        renderCart();
        updateSelectedNav("salesModeBtn");
      } else if (sectionId === 'editMode') {
        renderItemsList();
        updateSelectedNav("editModeBtn");
      } else if (sectionId === 'historyMode') {
        renderHistory();
        updateSelectedNav("historyModeBtn");
      }
    }
    document.getElementById('editModeBtn').addEventListener("click", () => showSection('editMode'));
    document.getElementById('salesModeBtn').addEventListener("click", () => showSection('salesMode'));
    document.getElementById('historyModeBtn').addEventListener("click", () => showSection('historyMode'));

    /***** Dark Mode í† ê¸€ (í† ê¸€ ìƒíƒœì— ë”°ë¼ ì´ëª¨ì§€/ê¸€ì ë³€ê²½) *****/
    const darkModeToggleBtn = document.getElementById("darkModeToggle");
    darkModeToggleBtn.addEventListener('click', function() {
      document.body.classList.toggle("dark-mode");
      if (document.body.classList.contains("dark-mode")) {
        darkModeToggleBtn.textContent = "â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ";
      } else {
        darkModeToggleBtn.textContent = "ğŸŒ™ ë‹¤í¬ëª¨ë“œ";
      }
    });

    /***** Modal for Add/Edit Item *****/
    let modalMode = ""; // "add" ë˜ëŠ” "edit"
    let editingItemId = null;
    function openItemModal(mode, item = null) {
      modalMode = mode;
      const modal = document.getElementById('itemModal');
      const title = document.getElementById('itemModalTitle');
      const nameInput = document.getElementById('modalItemName');
      const priceInput = document.getElementById('modalItemPrice');
      const fileInput = document.getElementById('modalItemImageFile');
      if (mode === "add") {
        title.textContent = "ì•„ì´í…œ ì¶”ê°€";
        nameInput.value = "";
        priceInput.value = "";
        fileInput.value = "";
        editingItemId = null;
      } else if (mode === "edit" && item) {
        title.textContent = "ì•„ì´í…œ ìˆ˜ì •";
        nameInput.value = item.name;
        priceInput.value = item.price;
        fileInput.value = "";
        editingItemId = item.id;
      }
      modal.style.display = "block";
    }
    function closeItemModal() { document.getElementById('itemModal').style.display = "none"; }
    document.getElementById('modalCancelBtn').addEventListener('click', closeItemModal);
    
    // ì´ë¯¸ì§€ íŒŒì¼ì„ 300Ã—300ìœ¼ë¡œ ì¶•ì†Œ í›„ Blob ë³€í™˜
    function processImage(file, callback) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.createElement('canvas');
          canvas.width = 300; canvas.height = 300;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, 300, 300);
          canvas.toBlob(function(blob) { callback(blob); }, 'image/png');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    // Modal í¼ ì œì¶œ: add ë˜ëŠ” edit ì²˜ë¦¬
    document.getElementById('itemModalForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('modalItemName').value.trim();
      const price = parseFloat(document.getElementById('modalItemPrice').value);
      const fileInput = document.getElementById('modalItemImageFile');
      const file = fileInput.files[0];
      
      if (modalMode === "add") {
        const itemId = Date.now();
        let newItem = { id: itemId, name, price, hasImage: false };
        function addNewItem() {
          items.push(newItem);
          renderItemsList();
          renderAvailableItems();
          updateNavButtons();
          closeItemModal();
        }
        if (file) {
          processImage(file, function(blob) {
            newItem.hasImage = true;
            storeImageInDB(itemId, blob);
            addNewItem();
          });
        } else { addNewItem(); }
      } else if (modalMode === "edit" && editingItemId !== null) {
        let item = items.find(it => it.id === editingItemId);
        if (item) {
          item.name = name;
          item.price = price;
          function updateItem() {
            renderItemsList();
            renderAvailableItems();
            updateNavButtons();
            closeItemModal();
          }
          if (file) {
            processImage(file, function(blob) {
              item.hasImage = true;
              storeImageInDB(item.id, blob);
              updateItem();
            });
          } else { updateItem(); }
        }
      }
    });
    // "ìƒˆ ì•„ì´í…œ ì¶”ê°€" ë²„íŠ¼ (ì¹´ë“œí˜•) í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
    document.getElementById('openNewItemModalBtn').addEventListener('click', function() {
      openItemModal("add");
    });
    // ì•„ì´í…œ ìˆ˜ì • ì‹œ ëª¨ë‹¬ ì—´ê¸°
    function editItem(id) {
      const item = items.find(it => it.id === id);
      if (item) { openItemModal("edit", item); }
    }
    // ì•„ì´í…œ ì‚­ì œ
    function deleteItem(id) {
      items = items.filter(it => it.id !== id);
      renderItemsList();
      renderAvailableItems();
      updateNavButtons();
    }
    
    /***** íŒë§¤í™”ë©´: ìƒí’ˆ ë° ì¥ë°”êµ¬ë‹ˆ ê´€ë¦¬ *****/
    function renderAvailableItems() {
      const availableDiv = document.getElementById('availableItems');
      availableDiv.innerHTML = '';
      items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        const imgElem = document.createElement('img');
        imgElem.alt = item.name;
        if (item.hasImage) {
          getImageFromDB(item.id, function(url) { imgElem.src = url ? url : ''; });
        } else { imgElem.src = ''; }
        itemDiv.appendChild(imgElem);
        const nameDiv = document.createElement('div');
        nameDiv.innerHTML = `<strong>${item.name}</strong>`;
        itemDiv.appendChild(nameDiv);
        const priceDiv = document.createElement('div');
        priceDiv.textContent = `${formatPrice(item.price)} ì›`;
        itemDiv.appendChild(priceDiv);
        itemDiv.addEventListener('click', function() { addToCart(item.id); });
        availableDiv.appendChild(itemDiv);
      });
    }
    function renderItemsList() {
      const listDiv = document.getElementById('itemsList');
      listDiv.innerHTML = '';
      const gridContainer = document.createElement('div');
      gridContainer.style.display = 'grid';
      gridContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
      gridContainer.style.gap = '10px';
      items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        itemDiv.style.textAlign = 'center';
        const imgElem = document.createElement('img');
        imgElem.alt = item.name;
        if (item.hasImage) {
          getImageFromDB(item.id, function(url) { imgElem.src = url ? url : ''; });
        } else { imgElem.src = ''; }
        itemDiv.appendChild(imgElem);
        const nameDiv = document.createElement('div');
        nameDiv.innerHTML = `<strong>${item.name}</strong>`;
        itemDiv.appendChild(nameDiv);
        const priceDiv = document.createElement('div');
        priceDiv.textContent = `ê°€ê²©: ${formatPrice(item.price)} ì›`;
        itemDiv.appendChild(priceDiv);
        const editBtn = document.createElement('button');
        editBtn.textContent = 'ìˆ˜ì •';
        editBtn.onclick = function() { editItem(item.id); };
        itemDiv.appendChild(editBtn);
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'ì‚­ì œ';
        deleteBtn.onclick = function() { deleteItem(item.id); };
        itemDiv.appendChild(deleteBtn);
        gridContainer.appendChild(itemDiv);
      });
      listDiv.appendChild(gridContainer);
    }
    function addToCart(id) {
      const item = items.find(it => it.id === id);
      if (item) {
        if (cart[id]) { cart[id].quantity += 1; }
        else { cart[id] = { ...item, quantity: 1 }; }
        renderCart();
      }
    }
    function renderCart() {
      const cartDiv = document.getElementById('cart');
      cartDiv.innerHTML = '';
      let total = 0;
      for (let key in cart) {
        const cartItem = cart[key];
        total += cartItem.price * cartItem.quantity;
        const cartItemDiv = document.createElement('div');
        cartItemDiv.className = 'cart-item';
        cartItemDiv.innerHTML = `
          <span>${cartItem.name} - ${formatPrice(cartItem.price)} ì› x ${cartItem.quantity} = ${formatPrice(cartItem.price * cartItem.quantity)} ì›</span>
          <button onclick="updateCartItem(${cartItem.id}, -1)">-</button>
          <button onclick="updateCartItem(${cartItem.id}, 1)">+</button>
          <button onclick="removeCartItem(${cartItem.id})">ì‚­ì œ</button>
        `;
        cartDiv.appendChild(cartItemDiv);
      }
      document.getElementById('totalPrice').textContent = formatPrice(total);
    }
    function updateCartItem(id, delta) {
      if (cart[id]) {
        cart[id].quantity += delta;
        if (cart[id].quantity < 1) { delete cart[id]; }
        renderCart();
      }
    }
    function removeCartItem(id) {
      if (cart[id]) { delete cart[id]; renderCart(); }
    }
    document.getElementById('sellBtn').addEventListener('click', function() {
      const cartItems = Object.values(cart);
      if (cartItems.length === 0) { alert("ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤."); return; }
      const totalAmount = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const timestamp = new Date();
      const receipt = { id: Date.now(), time: timestamp, items: cartItems, total: totalAmount };
      saleHistory.push(receipt);
      alert("íŒë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì˜ìˆ˜ì¦ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
      cart = {};
      renderCart();
      updateNavButtons();
    });
    
    /***** íŒë§¤ë‚´ì—­ ë Œë”ë§ (ìµœì‹  ê±°ë˜ê°€ ë¨¼ì € ë³´ì´ë„ë¡) *****/
    function renderHistory() {
      const historyDiv = document.getElementById('historyList');
      historyDiv.innerHTML = '';
      let grouped = {};
      saleHistory.forEach(receipt => {
        let dateStr = receipt.time.toISOString().split('T')[0];
        if (!grouped[dateStr]) { grouped[dateStr] = []; }
        grouped[dateStr].push(receipt);
      });
      let dateKeys = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));
      dateKeys.forEach(date => {
        let receipts = grouped[date].sort((a, b) => b.time - a.time);
        const totalForDate = receipts.reduce((sum, r) => sum + r.total, 0);
        const dateDiv = document.createElement('div');
        dateDiv.className = 'receipt';
        dateDiv.innerHTML = `
          <strong>${date}</strong> - ì´ íŒë§¤ ê¸ˆì•¡: ${formatPrice(totalForDate)} ì› 
          <button onclick="toggleDetails('${date}')">ìƒì„¸ë³´ê¸°</button>
          <div id="details-${date}" style="display: none; margin-top: 10px;"></div>
        `;
        historyDiv.appendChild(dateDiv);
        const detailsDiv = document.getElementById(`details-${date}`);
        receipts.forEach(r => {
          const rDiv = document.createElement('div');
          rDiv.style.borderTop = '1px dashed #aaa';
          rDiv.style.paddingTop = '5px';
          rDiv.innerHTML = `
            <div>ì‹œê°„: ${r.time.toLocaleTimeString()}</div>
            <div>ì´ í•©ê³„: ${formatPrice(r.total)} ì›</div>
            <div>ì•„ì´í…œ ëª©ë¡:</div>
            <ul>
              ${r.items.map(item => `<li>${item.name} - ${formatPrice(item.price)} ì› x ${item.quantity}</li>`).join('')}
            </ul>
            <button onclick="deleteReceipt(${r.id})">ì‚­ì œ</button>
          `;
          detailsDiv.appendChild(rDiv);
        });
      });
    }
    function toggleDetails(date) {
      const detailsDiv = document.getElementById(`details-${date}`);
      detailsDiv.style.display = (detailsDiv.style.display === 'none' || detailsDiv.style.display === '') ? 'block' : 'none';
    }
    function deleteReceipt(id) {
      saleHistory = saleHistory.filter(r => r.id !== id);
      renderHistory();
      updateNavButtons();
    }
    
    /***** ì „ì²´ë‚´ìš© ë°±ì—…í•˜ê¸° / ë³µì›í•˜ê¸° *****/
    function exportData() {
      const data = { items: items, saleHistory: saleHistory };
      const dataStr = JSON.stringify(data, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pos_data.json';
      a.click();
      URL.revokeObjectURL(url);
    }
    function importData(e) {
      const file = e.target.files[0];
      if (!file) return;
      if (!confirm("ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        e.target.value = "";
        return;
      }
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const importedData = JSON.parse(event.target.result);
          if (importedData.items && importedData.saleHistory) {
            importedData.saleHistory.forEach(receipt => {
              receipt.time = new Date(receipt.time);
            });
            items = importedData.items;
            saleHistory = importedData.saleHistory;
            renderItemsList();
            renderAvailableItems();
            renderHistory();
            alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateNavButtons();
          } else { alert('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.'); }
        } catch(err) {
          alert('ë°ì´í„° ë³µêµ¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
        e.target.value = "";
      };
      reader.readAsText(file);
    }
    document.getElementById('exportBtn').addEventListener('click', exportData);
    document.getElementById('importBtn').addEventListener('click', function() {
      document.getElementById('importFile').click();
    });
    document.getElementById('importFile').addEventListener('change', importData);
    
    // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    updateNavButtons();
  </script>
</body>
</html>
